<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fenwick Tree (BIT) - Interactive Learning</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #f5f5f5;
            min-height: 100vh;
        }

        .nav-bar {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
            padding: 15px 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .nav-bar a {
            color: white;
            text-decoration: none;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-bar h1 {
            color: white;
            font-size: 1.5em;
            flex: 1;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
        }

        .card h2 {
            font-size: 1.8em;
            color: #1a1a2e;
            margin-bottom: 20px;
            border-bottom: 3px solid #8b5cf6;
            padding-bottom: 10px;
        }

        .card p {
            color: #555;
            line-height: 1.8;
            margin-bottom: 15px;
        }

        .info-box {
            background: #f5f3ff;
            border: 2px solid #8b5cf6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .info-box h4 {
            color: #7c3aed;
            margin-bottom: 10px;
        }

        .info-box p,
        .info-box li {
            color: #5b21b6;
            line-height: 1.6;
        }

        .code-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 13px;
            margin: 15px 0;
            overflow-x: auto;
        }

        .code-box .keyword {
            color: #569cd6;
        }

        .code-box .comment {
            color: #6a9955;
        }

        .code-box .function {
            color: #dcdcaa;
        }

        .nav-buttons {
            display: flex;
            justify-content: space-between;
            margin-top: 40px;
            padding-top: 30px;
            border-top: 2px solid #e0e0e0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: #8b5cf6;
            color: white;
        }

        .btn-secondary {
            background: white;
            color: #1a1a2e;
            border: 2px solid #e0e0e0;
        }

        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        .comparison-table th,
        .comparison-table td {
            padding: 12px 15px;
            border: 1px solid #e0e0e0;
            text-align: center;
        }

        .comparison-table th {
            background: #8b5cf6;
            color: white;
        }
    </style>
</head>

<body>
    <div class="nav-bar">
        <a href="index.html"><i class="fas fa-home"></i> Home</a>
        <h1><i class="fas fa-calculator"></i> Fenwick Tree (Binary Indexed Tree)</h1>
        <a href="tree-algorithms.html">Next: Tree Algorithms <i class="fas fa-arrow-right"></i></a>
    </div>
    <div class="container">
        <div class="card">
            <h2>What is a Fenwick Tree?</h2>
            <p>A <strong>Fenwick Tree</strong> (also known as Binary Indexed Tree or BIT) is a data structure that can
                efficiently update elements and calculate prefix sums in a table of numbers.</p>
            <div class="info-box">
                <h4><i class="fas fa-lightbulb"></i> Key Advantage</h4>
                <p>Simpler to implement than Segment Trees! Uses only O(n) space and provides O(log n) for both prefix
                    sum queries and point updates.</p>
            </div>
        </div>
        <div class="card">
            <h2>Operations</h2>
            <table class="comparison-table">
                <tr>
                    <th>Operation</th>
                    <th>Time</th>
                    <th>Description</th>
                </tr>
                <tr>
                    <td>Prefix Sum</td>
                    <td>O(log n)</td>
                    <td>Sum of elements from index 1 to i</td>
                </tr>
                <tr>
                    <td>Range Sum</td>
                    <td>O(log n)</td>
                    <td>sum(l, r) = prefix(r) - prefix(l-1)</td>
                </tr>
                <tr>
                    <td>Point Update</td>
                    <td>O(log n)</td>
                    <td>Add value to element at index i</td>
                </tr>
                <tr>
                    <td>Space</td>
                    <td>O(n)</td>
                    <td>Just one array of size n+1</td>
                </tr>
            </table>
        </div>
        <div class="card">
            <h2>Key Insight: Lowbit</h2>
            <p>The magic of Fenwick Tree comes from the <strong>lowbit</strong> operation - finding the lowest set bit
                of a number.</p>
            <div class="code-box">
                <span class="comment">// Get lowest set bit</span>
                <span class="keyword">function</span> <span class="function">lowbit</span>(x):
                <span class="keyword">return</span> x & (-x)

                <span class="comment">// Examples:</span>
                <span class="comment">// lowbit(6) = lowbit(110) = 2 (10)</span>
                <span class="comment">// lowbit(12) = lowbit(1100) = 4 (100)</span>
            </div>
        </div>
        <div class="card">
            <h2>Update Operation</h2>
            <div class="code-box">
                <span class="keyword">function</span> <span class="function">update</span>(BIT, n, i, delta):
                <span class="keyword">while</span> i <= n: BIT[i] +=delta i +=<span class="function">lowbit</span>(i)
                    <span class="comment">// Move to parent</span>
            </div>
        </div>
        <div class="card">
            <h2>Prefix Sum Query</h2>
            <div class="code-box">
                <span class="keyword">function</span> <span class="function">prefixSum</span>(BIT, i):
                sum = 0
                <span class="keyword">while</span> i > 0:
                sum += BIT[i]
                i -= <span class="function">lowbit</span>(i) <span class="comment">// Move to previous range</span>
                <span class="keyword">return</span> sum
            </div>
        </div>
        <div class="card">
            <h2>Range Sum Query</h2>
            <p>To query sum of range [l, r], use the prefix sum difference:</p>
            <div class="code-box">
                <span class="keyword">function</span> <span class="function">rangeSum</span>(BIT, l, r):
                <span class="keyword">return</span> <span class="function">prefixSum</span>(BIT, r) - <span
                    class="function">prefixSum</span>(BIT, l - 1)

                <span class="comment">// Example: sum of elements from index 3 to 7</span>
                <span class="comment">// rangeSum(3, 7) = prefixSum(7) - prefixSum(2)</span>
            </div>
        </div>

        <div class="card">
            <h2>Range Update + Point Query</h2>
            <p>We can support range updates [l, r] with value v using a difference array approach:</p>

            <div class="info-box">
                <h4><i class="fas fa-lightbulb"></i> Key Idea</h4>
                <p>Store differences instead of actual values. A range update becomes two point updates!</p>
            </div>

            <div class="code-box">
                <span class="comment">// Range update: add v to all elements in [l, r]</span>
                <span class="keyword">function</span> <span class="function">rangeUpdate</span>(BIT, n, l, r, v):
                <span class="function">update</span>(BIT, n, l, v) <span class="comment">// Add v starting from l</span>
                <span class="function">update</span>(BIT, n, r + 1, -v) <span class="comment">// Cancel effect after
                    r</span>

                <span class="comment">// Point query: get value at index i</span>
                <span class="keyword">function</span> <span class="function">pointQuery</span>(BIT, i):
                <span class="keyword">return</span> <span class="function">prefixSum</span>(BIT, i) <span
                    class="comment">// Sum of differences = actual value</span>

                <span class="comment">// Example: rangeUpdate([3, 7], +5)</span>
                <span class="comment">// update(3, +5) -> adds 5 to indices 3, 4, 5, 6, 7, 8, ...</span>
                <span class="comment">// update(8, -5) -> subtracts 5 from 8, 9, 10, ...</span>
                <span class="comment">// Net effect: elements 3-7 increased by 5</span>
            </div>
        </div>

        <div class="card">
            <h2>Range Update + Range Query</h2>
            <p>To support both range updates AND range queries, we need <strong>two BITs</strong>:</p>

            <div class="code-box">
                <span class="comment">// Using two BITs: BIT1 and BIT2</span>
                <span class="comment">// Original value at index i = BIT1.prefix(i) * i - BIT2.prefix(i)</span>

                <span class="keyword">function</span> <span class="function">rangeUpdateRQ</span>(l, r, v):
                <span class="comment">// Update BIT1 (difference array)</span>
                <span class="function">update</span>(BIT1, l, v)
                <span class="function">update</span>(BIT1, r + 1, -v)

                <span class="comment">// Update BIT2 (correction term)</span>
                <span class="function">update</span>(BIT2, l, v * (l - 1))
                <span class="function">update</span>(BIT2, r + 1, -v * r)

                <span class="keyword">function</span> <span class="function">prefixSumRQ</span>(i):
                <span class="keyword">return</span> <span class="function">prefixSum</span>(BIT1, i) * i - <span
                    class="function">prefixSum</span>(BIT2, i)

                <span class="keyword">function</span> <span class="function">rangeSumRQ</span>(l, r):
                <span class="keyword">return</span> <span class="function">prefixSumRQ</span>(r) - <span
                    class="function">prefixSumRQ</span>(l - 1)
            </div>
        </div>

        <div class="card">
            <h2>2D Fenwick Tree</h2>
            <p>Extend BIT to 2D for matrix queries like "sum of rectangle" or "2D point updates".</p>

            <div class="code-box">
                <span class="comment">// 2D BIT for n × m matrix</span>
                BIT2D = array[n+1][m+1] initialized to 0

                <span class="keyword">function</span> <span class="function">update2D</span>(x, y, delta):
                i = x
                <span class="keyword">while</span> i <= n: j=y <span class="keyword">while</span> j <= m: BIT2D[i][j]
                        +=delta j +=<span class="function">lowbit</span>(j)
                        i += <span class="function">lowbit</span>(i)

                        <span class="keyword">function</span> <span class="function">prefixSum2D</span>(x, y):
                        sum = 0
                        i = x
                        <span class="keyword">while</span> i > 0:
                        j = y
                        <span class="keyword">while</span> j > 0:
                        sum += BIT2D[i][j]
                        j -= <span class="function">lowbit</span>(j)
                        i -= <span class="function">lowbit</span>(i)
                        <span class="keyword">return</span> sum

                        <span class="comment">// Rectangle sum [x1,y1] to [x2,y2] using inclusion-exclusion</span>
                        <span class="keyword">function</span> <span class="function">rectangleSum</span>(x1, y1, x2,
                        y2):
                        <span class="keyword">return</span> <span class="function">prefixSum2D</span>(x2, y2)
                        - <span class="function">prefixSum2D</span>(x1-1, y2)
                        - <span class="function">prefixSum2D</span>(x2, y1-1)
                        + <span class="function">prefixSum2D</span>(x1-1, y1-1)
            </div>

            <p><strong>Complexity:</strong> O(log n × log m) per operation, O(n × m) space</p>
        </div>

        <div class="card">
            <h2>Building BIT from Array</h2>
            <p>Initialize BIT from an existing array in O(n) time:</p>

            <div class="code-box">
                <span class="comment">// Naive O(n log n) approach</span>
                <span class="keyword">function</span> <span class="function">buildNaive</span>(arr, n):
                BIT = array[n+1] initialized to 0
                <span class="keyword">for</span> i = 1 to n:
                <span class="function">update</span>(BIT, n, i, arr[i])
                <span class="keyword">return</span> BIT

                <span class="comment">// Optimized O(n) approach</span>
                <span class="keyword">function</span> <span class="function">buildOptimized</span>(arr, n):
                BIT = copy of arr (1-indexed)
                <span class="keyword">for</span> i = 1 to n:
                parent = i + <span class="function">lowbit</span>(i)
                <span class="keyword">if</span> parent <= n: BIT[parent] +=BIT[i] <span class="keyword">return</span>
                    BIT
            </div>
        </div>

        <div class="card">
            <h2>Finding Kth Element</h2>
            <p>Find the smallest index i such that prefix sum ≥ k (useful for order statistics):</p>

            <div class="code-box">
                <span class="comment">// Binary search on BIT - O(log² n)</span>
                <span class="keyword">function</span> <span class="function">findKth</span>(BIT, n, k):
                lo = 1, hi = n
                <span class="keyword">while</span> lo < hi: mid=(lo + hi) / 2 <span class="keyword">if</span> <span
                        class="function">prefixSum</span>(BIT, mid) >= k:
                    hi = mid
                    <span class="keyword">else</span>:
                    lo = mid + 1
                    <span class="keyword">return</span> lo

                    <span class="comment">// Optimized O(log n) using bit manipulation</span>
                    <span class="keyword">function</span> <span class="function">findKthFast</span>(BIT, n, k):
                    pos = 0
                    curSum = 0
                    <span class="keyword">for</span> pw = log2(n) down to 0:
                    <span class="keyword">if</span> pos + 2^pw <= n <span class="keyword">and</span> curSum + BIT[pos +
                        2^pw] < k: pos +=2^pw curSum +=BIT[pos] <span class="keyword">return</span> pos + 1
            </div>
        </div>

        <div class="card">
            <h2>Common Applications</h2>
            <ul style="margin-left: 25px; color: #555; line-height: 2;">
                <li><strong>Prefix/Range sums</strong> - Classic use case with point updates</li>
                <li><strong>Inversion count</strong> - Count pairs where i < j but a[i]> a[j]</li>
                <li><strong>Range updates</strong> - With difference array technique</li>
                <li><strong>2D queries</strong> - Rectangle sums in matrices</li>
                <li><strong>Order statistics</strong> - Finding kth smallest element dynamically</li>
                <li><strong>Coordinate compression</strong> - Combined with value mapping</li>
            </ul>
        </div>

        <div class="card">
            <h2>Example: Inversion Count</h2>
            <p>Count inversions in array [3, 1, 2] using BIT:</p>

            <div class="code-box">
                <span class="comment">// Process elements from right to left</span>
                <span class="comment">// For each element, count how many smaller elements we've seen</span>

                arr = [3, 1, 2]
                BIT = [0, 0, 0, 0] <span class="comment">// For values 1, 2, 3</span>
                inversions = 0

                <span class="comment">// Step 1: Process 2 (rightmost)</span>
                inversions += prefixSum(BIT, 2-1) = 0 <span class="comment">// Elements < 2 seen: none</span>
                        update(BIT, 2, +1) <span class="comment">// Mark 2 as seen</span>

                        <span class="comment">// Step 2: Process 1</span>
                        inversions += prefixSum(BIT, 1-1) = 0 <span class="comment">// Elements < 1 seen: none</span>
                                update(BIT, 1, +1) <span class="comment">// Mark 1 as seen</span>

                                <span class="comment">// Step 3: Process 3</span>
                                inversions += prefixSum(BIT, 3-1) = 2 <span class="comment">// Elements < 3 seen: 1,
                                        2</span>
                                        update(BIT, 3, +1)

                                        <span class="comment">// Total inversions: 2 (pairs: (3,1), (3,2))</span>
            </div>
        </div>

        <div class="nav-buttons">
            <a href="segment-trees.html" class="btn btn-secondary"><i class="fas fa-arrow-left"></i> Segment Trees</a>
            <a href="tree-algorithms.html" class="btn btn-primary">Tree Algorithms <i
                    class="fas fa-arrow-right"></i></a>
        </div>
    </div>
</body>

</html>